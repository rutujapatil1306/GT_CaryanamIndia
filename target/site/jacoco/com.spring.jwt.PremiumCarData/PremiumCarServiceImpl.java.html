<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>PremiumCarServiceImpl.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">JWT-with-Spring-Security</a> &gt; <a href="index.source.html" class="el_package">com.spring.jwt.PremiumCarData</a> &gt; <span class="el_source">PremiumCarServiceImpl.java</span></div><h1>PremiumCarServiceImpl.java</h1><pre class="source lang-java linenums">package com.spring.jwt.PremiumCarData;

//import com.spring.jwt.dealer.DealerNotFoundException;
import com.spring.jwt.entity.Dealer;
import com.spring.jwt.entity.Status;
import com.spring.jwt.repository.DealerRepository;
import org.hibernate.service.spi.ServiceException;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.dao.DataIntegrityViolationException;
import org.springframework.data.domain.Page;
import org.springframework.data.domain.PageRequest;
import org.springframework.data.domain.Pageable;
import org.springframework.data.domain.Sort;
import org.springframework.stereotype.Service;

import java.util.Optional;

@Service
<span class="nc" id="L19">public class PremiumCarServiceImpl implements PremiumCarService {</span>

    @Autowired
    private PremiumCarRepository premiumCarRepository;

    @Override
    public PremiumCarDTO createPremiumCar(PremiumCarDTO dto) {
<span class="nc bnc" id="L26" title="All 2 branches missed.">        if (dto == null) {</span>
<span class="nc" id="L27">            throw new PremiumCarNotFoundException(&quot;PremiumCar data cannot be null&quot;);</span>
        }

        try {
            // Convert DTO -&gt; Entity
<span class="nc" id="L32">            PremiumCar entity = PremiumCarMapper.toEntity(dto);</span>

            // Save to DB
<span class="nc" id="L35">            PremiumCar savedEntity = premiumCarRepository.save(entity);</span>

            // Convert Entity -&gt; DTO (return saved details)
<span class="nc" id="L38">            return PremiumCarMapper.toDTO(savedEntity);</span>

<span class="nc" id="L40">        } catch (DataIntegrityViolationException e) {</span>
<span class="nc" id="L41">            throw new PremiumCarNotFoundException(&quot;Invalid PremiumCar data: &quot; + e.getMessage());</span>
<span class="nc" id="L42">        } catch (Exception s) {</span>
<span class="nc" id="L43">            throw new ServiceException(&quot;Error occurred while saving PremiumCar: &quot; + s.getMessage());</span>
        }
    }

    @Override
    public PremiumCarDTO updatePremiumCar(Integer id, PremiumCarDTO dto) {
<span class="nc" id="L49">        PremiumCar update = premiumCarRepository.findById(id)</span>
<span class="nc" id="L50">                .orElseThrow(() -&gt; new PremiumCarNotFoundException(&quot;Car with id &quot; + id + &quot; not found&quot;));</span>

        // Partial update with validation
<span class="nc bnc" id="L53" title="All 2 branches missed.">        if (dto.getBrand() != null) update.setBrand(dto.getBrand());</span>
<span class="nc bnc" id="L54" title="All 2 branches missed.">        if (dto.getVariant() != null) update.setVariant(dto.getVariant());</span>
<span class="nc bnc" id="L55" title="All 4 branches missed.">        if (dto.getPrice() != null &amp;&amp; dto.getPrice() &gt; 0) update.setPrice(dto.getPrice());</span>
<span class="nc bnc" id="L56" title="All 4 branches missed.">        if (dto.getYear() != null &amp;&amp; dto.getYear() &gt;= 2000) update.setYear(dto.getYear());</span>
<span class="nc bnc" id="L57" title="All 2 branches missed.">        if (dto.getCarstatus() != null) update.setCarstatus(dto.getCarstatus());</span>
<span class="nc bnc" id="L58" title="All 2 branches missed.">        if (dto.getCity() != null) update.setCity(dto.getCity());</span>
<span class="nc bnc" id="L59" title="All 2 branches missed.">        if (dto.getCarInsuranceDate() != null) update.setCarInsuranceDate(dto.getCarInsuranceDate());</span>
<span class="nc bnc" id="L60" title="All 2 branches missed.">        if (dto.getColor() != null) update.setColor(dto.getColor());</span>
<span class="nc bnc" id="L61" title="All 2 branches missed.">        if (dto.getCarType() != null) update.setCarType(dto.getCarType());</span>

        // Boolean flags
<span class="nc bnc" id="L64" title="All 2 branches missed.">        if (dto.getAirbag() != null) update.setAirbag(dto.getAirbag());</span>
<span class="nc bnc" id="L65" title="All 2 branches missed.">        if (dto.getABS() != null) update.setABS(dto.getABS());</span>

<span class="nc" id="L67">        PremiumCar saved = premiumCarRepository.save(update);</span>
<span class="nc" id="L68">        return PremiumCarMapper.toDTO(saved);</span>
    }


    @Override
    public PremiumCarDTO getPremiumCarById(Integer id) {
<span class="nc" id="L74">        PremiumCar car = premiumCarRepository.findById(id)</span>
<span class="nc" id="L75">                .orElseThrow(() -&gt; new PremiumCarNotFoundException(&quot;Car with id &quot; + id + &quot; not found&quot;));</span>
<span class="nc" id="L76">        return PremiumCarMapper.toDTO(car);</span>
    }

    @Override
    public void deletePremiumCar(Integer carId, String type) {

<span class="nc" id="L82">        PremiumCar car = premiumCarRepository.findById(carId)</span>
<span class="nc" id="L83">                .orElseThrow(() -&gt; new PremiumCarNotFoundException(&quot;Car not found with ID: &quot; + carId));</span>

<span class="nc bnc" id="L85" title="All 2 branches missed.">        if (type.equalsIgnoreCase(&quot;soft&quot;)) {</span>
            // Soft Delete (mark as inactive)
<span class="nc" id="L87">            car.setCarstatus(Status.ACTIVE); // assuming Status is an enum { ACTIVE, INACTIVE }</span>
<span class="nc" id="L88">            premiumCarRepository.save(car);</span>
<span class="nc bnc" id="L89" title="All 2 branches missed.">        } else if (type.equalsIgnoreCase(&quot;hard&quot;)) {</span>
            //  Hard Delete (remove from DB)
<span class="nc" id="L91">            premiumCarRepository.delete(car);</span>
        } else {
<span class="nc" id="L93">            throw new IllegalArgumentException(&quot;Invalid delete type. Use 'soft' or 'hard'.&quot;);</span>
        }
<span class="nc" id="L95">    }</span>




    @Override

    public Page&lt;PremiumCarDTO&gt; getCarsByDealerAndStatus(Long dealerId, Status status, Pageable pageable) {
        Page&lt;PremiumCar&gt; cars;

<span class="nc bnc" id="L105" title="All 2 branches missed.">        if (status != null) {</span>
<span class="nc" id="L106">            cars = premiumCarRepository.findByDealerIdAndCarstatus(dealerId, status, pageable);</span>
        } else {
<span class="nc" id="L108">            cars = premiumCarRepository.findByDealerId(dealerId, pageable);</span>
        }

<span class="nc bnc" id="L111" title="All 2 branches missed.">        if (cars.isEmpty()) {</span>
<span class="nc" id="L112">            throw new PremiumCarNotFoundException(&quot;No cars found for dealerId: &quot; + dealerId +</span>
<span class="nc bnc" id="L113" title="All 2 branches missed.">                    (status != null ? &quot; with status: &quot; + status : &quot;&quot;));</span>
        }

<span class="nc" id="L116">        return cars.map(PremiumCarMapper::toDTO);</span>
    }




    public Page&lt;PremiumCarDTO&gt; getCarsByStatus(Status status, int page, int size, String sortBy, String sortDir) {
        // Sorting logic
<span class="nc bnc" id="L124" title="All 2 branches missed.">        Sort sort = sortDir.equalsIgnoreCase(&quot;asc&quot;)</span>
<span class="nc" id="L125">                ? Sort.by(sortBy).ascending()</span>
<span class="nc" id="L126">                : Sort.by(sortBy).descending();</span>

<span class="nc" id="L128">        Pageable pageable = PageRequest.of(page, size, sort);</span>

        //  Fetch cars by status
<span class="nc" id="L131">        Page&lt;PremiumCar&gt; cars = premiumCarRepository.findByCarstatus(status, pageable);</span>

<span class="nc bnc" id="L133" title="All 2 branches missed.">        if (cars.isEmpty()) {</span>
<span class="nc" id="L134">            throw new PremiumCarNotFoundException(&quot;PremiumCar Not found with status: &quot; + status);</span>
        }

        //  Convert entity -&gt; DTO
<span class="nc" id="L138">        return cars.map(PremiumCarMapper::toDTO);</span>
    }

    @Override
    public PremiumCarDTO getCarByMainCarId(String mainCarId) {
<span class="nc" id="L143">        PremiumCar car = premiumCarRepository.findByMainCarId(mainCarId)</span>
<span class="nc" id="L144">                .orElseThrow(() -&gt; new PremiumCarNotFoundException(&quot;Car not found with mainCarId: &quot; + mainCarId));</span>
<span class="nc" id="L145">        return PremiumCarMapper.toDTO(car);</span>
    }



}

</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>